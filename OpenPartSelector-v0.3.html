<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– OpenPartSelector v0.3 - AIç”µå­å…ƒå™¨ä»¶é€‰å‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; padding: 40px 20px; }
        .logo { font-size: 60px; margin-bottom: 20px; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(90deg, #00d2ff, #3a7bd5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header p { color: #8892b0; font-size: 1.1em; }
        .card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 30px; margin: 20px 0; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .search-box { display: flex; gap: 10px; margin: 20px 0; }
        .search-box input { 
            flex: 1; padding: 18px 25px; font-size: 16px; 
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); 
            border-radius: 15px; color: #fff; outline: none; transition: all 0.3s;
        }
        .search-box input:focus { border-color: #00d2ff; background: rgba(255,255,255,0.15); }
        .search-box input::placeholder { color: rgba(255,255,255,0.5); }
        .search-box button { 
            padding: 18px 35px; font-size: 16px; font-weight: bold;
            background: linear-gradient(135deg, #00d2ff, #3a7bd5); 
            color: white; border: none; border-radius: 15px; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .search-box button:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,210,255,0.3); }
        .examples { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
        .example-btn { 
            padding: 10px 20px; background: rgba(255,255,255,0.1); 
            border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; 
            color: #fff; cursor: pointer; font-size: 14px; transition: all 0.2s;
        }
        .example-btn:hover { background: rgba(0,210,255,0.2); border-color: #00d2ff; }
        
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0; }
        .feature { text-align: center; padding: 25px; background: rgba(255,255,255,0.03); border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); transition: transform 0.3s; }
        .feature:hover { transform: translateY(-5px); background: rgba(255,255,255,0.08); }
        .feature-icon { font-size: 45px; margin-bottom: 15px; }
        .feature h3 { margin-bottom: 10px; color: #00d2ff; }
        .feature p { color: #8892b0; font-size: 14px; line-height: 1.6; }
        
        .result { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px; margin: 15px 0; border-left: 4px solid #00d2ff; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .result h3 { color: #00d2ff; margin-bottom: 10px; }
        .result p { color: #ccd6f6; margin: 5px 0; }
        .tags { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .tag { padding: 6px 15px; background: rgba(0,210,255,0.2); border-radius: 20px; font-size: 13px; }
        .tag.price { background: rgba(40, 167, 69, 0.3); }
        .tag.warning { background: rgba(255, 193, 7, 0.3); }
        .tag.danger { background: rgba(220, 53, 69, 0.3); }
        .tag.success { background: rgba(40, 167, 69, 0.3); }
        
        .loading { text-align: center; padding: 40px; display: none; }
        .loading.show { display: block; }
        .spinner { width: 50px; height: 50px; border: 4px solid rgba(255,255,255,0.1); border-top-color: #00d2ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .bom-section { margin-top: 40px; }
        .bom-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .bom-table th, .bom-table td { padding: 15px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .bom-table th { color: #00d2ff; font-weight: 600; }
        .bom-table tr:hover { background: rgba(255,255,255,0.05); }
        
        .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
        .stat { text-align: center; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px; }
        .stat-value { font-size: 2em; font-weight: bold; color: #00d2ff; }
        .stat-label { color: #8892b0; font-size: 14px; margin-top: 5px; }
        
        .warning-box { background: rgba(255, 193, 7, 0.1); border: 1px solid rgba(255, 193, 7, 0.3); border-radius: 10px; padding: 20px; margin: 20px 0; }
        .warning-box h4 { color: #ffc107; margin-bottom: 10px; }
        .warning-box ul { margin-left: 20px; color: #ccd6f6; }
        
        .footer { text-align: center; padding: 40px; color: #8892b0; font-size: 14px; }
        .footer a { color: #00d2ff; text-decoration: none; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab { padding: 12px 25px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; cursor: pointer; color: #8892b0; transition: all 0.2s; }
        .tab.active { background: rgba(0,210,255,0.2); border-color: #00d2ff; color: #fff; }
        .tab:hover:not(.active) { background: rgba(255,255,255,0.1); }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .search-box { flex-direction: column; }
            .stats { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸ¤–</div>
            <h1>OpenPartSelector v0.3</h1>
            <p>AIç”µå­å…ƒå™¨ä»¶æ™ºèƒ½é€‰å‹å¼•æ“ | å¼€æºå…è´¹ | ç«‹å³å¯ç”¨</p>
        </div>

        <div class="card">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('select')">ğŸ” æ™ºèƒ½é€‰å‹</div>
                <div class="tab" onclick="switchTab('bom')">ğŸ“‹ BOMåˆ†æ</div>
                <div class="tab" onclick="switchTab('eol')">ğŸš¨ EOLé¢„è­¦</div>
                <div class="tab" onclick="switchTab('cad')">ğŸ”Œ CADåº“</div>
                <div class="tab" onclick="switchTab('favorites')">â¤ï¸ æ”¶è—</div>
            </div>

            <!-- é€‰å‹é¢æ¿ -->
            <div id="panel-select">
                <h2>ğŸ” æ™ºèƒ½é€‰å‹</h2>
                <p style="color: #8892b0; margin: 10px 0;">è¾“å…¥é€‰å‹éœ€æ±‚ï¼ŒAIè‡ªåŠ¨æ¨èæœ€ä¼˜å™¨ä»¶</p>
                
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="ä¾‹å¦‚ï¼šæ‰¾ä¸€ä¸ª 3.3V LDO 1A">
                    <button onclick="search()">ğŸ” å¼€å§‹é€‰å‹</button>
                </div>
                
                <p style="color: #8892b0;">ğŸ’¡ çƒ­é—¨æœç´¢:</p>
                <div class="examples">
                    <button class="example-btn" onclick="setQuery('æ‰¾ä¸€ä¸ª 3.3V LDO 1A')">æ‰¾ä¸€ä¸ª 3.3V LDO 1A</button>
                    <button class="example-btn" onclick="setQuery('ESP32 WiFi æ¨¡å—')">ESP32 WiFi æ¨¡å—</button>
                    <button class="example-btn" onclick="setQuery('STM32 å•ç‰‡æœº å›½äº§æ›¿ä»£')">STM32 å›½äº§æ›¿ä»£</button>
                    <button class="example-btn" onclick="setQuery('USB è½¬ä¸²å£èŠ¯ç‰‡')">USB è½¬ä¸²å£</button>
                    <button class="example-btn" onclick="setQuery('åŒè¿æ”¾ ä½å™ªå£°')">åŒè¿æ”¾</button>
                </div>

                <!-- æœç´¢å†å² -->
                <div id="history-list" style="margin:15px 0;"></div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>ğŸ¤– AI æ­£åœ¨åˆ†æé€‰å‹...</p>
                </div>

                <div id="results"></div>
            </div>

            <!-- BOMåˆ†æé¢æ¿ -->
            <div id="panel-bom" style="display:none;">
                <h2>ğŸ“‹ BOM åˆ†æ</h2>
                <p style="color: #8892b0; margin: 10px 0;">åˆ†æå™¨ä»¶æ¸…å•çš„é£é™©ã€æˆæœ¬å’Œä¾›åº”é“¾çŠ¶æ€</p>
                
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="bom-count">5</div>
                        <div class="stat-label">å™¨ä»¶ç§ç±»</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="bom-price">Â¥3.12</div>
                        <div class="stat-label">é¢„ä¼°æ€»ä»·</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="bom-risk" style="color: #ffc107;">1</div>
                        <div class="stat-label">é«˜é£é™©å™¨ä»¶</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="bom-save">Â¥0.84</div>
                        <div class="stat-label">é¢„ä¼°èŠ‚çœ</div>
                    </div>
                </div>

                <table class="bom-table">
                    <thead>
                        <tr>
                            <th>ä½å·</th>
                            <th>å‹å·</th>
                            <th>æ•°é‡</th>
                            <th>å•ä»·</th>
                            <th>çŠ¶æ€</th>
                            <th>é£é™©</th>
                        </tr>
                    </thead>
                    <tbody id="bom-body">
                        <tr><td colspan="6" style="text-align:center;color:#8892b0;">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ è½½ç¤ºä¾‹BOM</td></tr>
                    </tbody>
                </table>

                <button class="example-btn" onclick="loadBOM()" style="width:100%;">ğŸ“¥ åŠ è½½ç¤ºä¾‹ BOM</button>
            </div>

            <!-- EOLé¢„è­¦é¢æ¿ -->
            <div id="panel-eol" style="display:none;">
                <h2>ğŸš¨ EOL åœäº§é¢„è­¦</h2>
                <p style="color: #8892b0; margin: 10px 0;">æ¯å¹´47ä¸‡+å™¨ä»¶åœäº§ï¼Œæå‰é¢„è­¦é£é™©</p>
                
                <div class="warning-box">
                    <h4>âš ï¸ é‡è¦é¢„è­¦</h4>
                    <ul>
                        <li><strong>STM32F103C8T6</strong> - NRND (ä¸æ¨èæ–°è®¾è®¡) - å»ºè®®: STM32G431CBU6</li>
                        <li><strong>ATMEGA328P</strong> - Active - å»ºè®®: AVR DD (æ›´ä½åŠŸè€—)</li>
                        <li><strong>ESP32-WROOM-32</strong> - Active - å¯è€ƒè™‘ ESP32-C3 (æ›´ä¾¿å®œ)</li>
                    </ul>
                </div>

                <h3 style="margin: 20px 0 10px;">ğŸ“Š å™¨ä»¶çŠ¶æ€è¯´æ˜</h3>
                <div class="tags">
                    <span class="tag success">âœ… Active - æ­£å¸¸ä¾›è´§</span>
                    <span class="tag warning">âš ï¸ NRND - ä¸æ¨èæ–°è®¾è®¡</span>
                    <span class="tag danger">ğŸ”´ LastTimeBuy - æœ€åè´­ä¹°æœŸ</span>
                    <span class="tag">âŒ Obsolete - å·²åœäº§</span>
                </div>
            </div>

            <!-- CADåº“é¢æ¿ -->
            <div id="panel-cad" style="display:none;">
                <h2>ğŸ”Œ CAD åº“ä¸‹è½½</h2>
                <p style="color: #8892b0; margin: 10px 0;">ä¸€é”®ä¸‹è½½ Symbol / Footprint / 3D Model</p>
                
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:15px; margin:20px 0;">
                    <div class="feature" onclick="alert('å°†è·³è½¬åˆ° SamacSys ä¸‹è½½')">
                        <div class="feature-icon">ğŸ“¦</div>
                        <h3>SamacSys</h3>
                        <p>120ä¸‡+å™¨ä»¶<br>Altium/KiCad/Eagle</p>
                    </div>
                    <div class="feature" onclick="alert('å°†è·³è½¬åˆ° Ultra Librarian ä¸‹è½½')">
                        <div class="feature-icon">ğŸ“š</div>
                        <h3>Ultra Librarian</h3>
                        <p>300ä¸‡+å™¨ä»¶<br>æ‰€æœ‰ä¸»æµEDA</p>
                    </div>
                    <div class="feature" onclick="alert('å°†è·³è½¬åˆ° KiCad å®˜ç½‘')">
                        <div class="feature-icon">âš¡</div>
                        <h3>KiCad å®˜æ–¹åº“</h3>
                        <p>æŒç»­æ›´æ–°<br>å®Œå…¨å…è´¹</p>
                    </div>
                </div>

                <h3 style="margin: 20px 0 10px;">ğŸ“‹ å¸¸è§å™¨ä»¶çŠ¶æ€</h3>
                <table class="bom-table">
                    <thead>
                        <tr><th>å‹å·</th><th>Symbol</th><th>Footprint</th><th>3D Model</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>STM32F103C8T6</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr>
                        <tr><td>ESP32-WROOM</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr>
                        <tr><td>CH340G</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr>
                        <tr><td>LM358</td><td>âœ…</td><td>âœ…</td><td>âœ…</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- æ”¶è—é¢æ¿ -->
            <div id="panel-favorites" style="display:none;">
                <h2>â¤ï¸ æˆ‘çš„æ”¶è—</h2>
                <p style="color: #8892b0; margin: 10px 0;">æ”¶è—æ„Ÿå…´è¶£çš„å™¨ä»¶ï¼Œæ–¹ä¾¿éšæ—¶æŸ¥çœ‹</p>
                
                <div id="favorites-list">
                    <div style="text-align:center;padding:40px;color:#8892b0;">
                        <p style="font-size:48px;margin-bottom:15px;">ğŸ’”</p>
                        <p>æš‚æ— æ”¶è—</p>
                        <p style="font-size:13px;margin-top:10px;">ç‚¹å‡»ç»“æœå¡ç‰‡ä¸Šçš„ â¤ï¸ æ·»åŠ æ”¶è—</p>
                    </div>
                </div>
                
                <button class="example-btn" onclick="clearFavorites()" style="width:100%;margin-top:15px;">ğŸ—‘ï¸ æ¸…ç©ºæ”¶è—</button>
            </div>
        </div>

        <div class="card">
            <h2>âœ¨ æ ¸å¿ƒåŠŸèƒ½</h2>
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">ğŸ¤–</div>
                    <h3>AI æ™ºèƒ½é€‰å‹</h3>
                    <p>è‡ªç„¶è¯­è¨€è¾“å…¥<br>å¤šå¹³å°æ¯”ä»·<br>ç§’çº§æ¨è</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ‡¨ğŸ‡³</div>
                    <h3>å›½äº§æ›¿ä»£</h3>
                    <p>STM32â†’GD32<br>é™æœ¬30%<br>pin2pinå…¼å®¹</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸš¨</div>
                    <h3>EOL é¢„è­¦</h3>
                    <p>47ä¸‡+/å¹´åœäº§<br>æå‰é¢„è­¦<br>æ›¿ä»£æ–¹æ¡ˆ</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ”Œ</div>
                    <h3>CAD åº“</h3>
                    <p>SamacSysé›†æˆ<br>ä¸€é”®ä¸‹è½½<br>ç¬¦å·/å°è£…/3D</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ“‹</div>
                    <h3>BOM åˆ†æ</h3>
                    <p>ä¾›åº”é“¾é£é™©<br>æˆæœ¬ä¼˜åŒ–<br>å®Œæ•´æŠ¥å‘Š</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">ğŸ­</div>
                    <h3>ç«‹åˆ›ç”Ÿæ€</h3>
                    <p>ç«‹åˆ›å•†åŸ<br>SMTæŠ¥ä»·<br>ä¸€ç«™å¼é‡‡è´­</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>ğŸ¤– <strong>OpenPartSelector v0.3</strong> | å¼€æºå…è´¹ | MIT License</p>
            <p style="margin-top:10px;">
                ğŸ“¦ <a href="https://github.com/KINGSTON-115/OpenPartSelector" target="_blank">GitHub</a> | 
                ğŸ“§ <a href="mailto:zhenweisi@openclaw.ai">åé¦ˆ</a> |
                ğŸ“„ <a href="#" onclick="alert('ç‰ˆæœ¬: 0.3.0\n\næ ¸å¿ƒæ¨¡å—:\n- Agent: AIé€‰å‹\n- BOM: å®Œæ•´åˆ†æ\n- EOL: åœäº§é¢„è­¦\n- CAD: åº“é›†æˆ\n- Favorites: æ”¶è—åŠŸèƒ½\n\næ›´æ–°æ—¥å¿— v0.3:\n- âœ¨ æ–°å¢æ”¶è—åŠŸèƒ½\n- âœ¨ æ–°å¢æœç´¢å†å²\n- âœ¨ å¢å¼ºæœç´¢ç®—æ³•\n- âœ¨ æ‰©å……å™¨ä»¶æ•°æ®åº“\n- ğŸ› ä¿®å¤bug')">å…³äº</a>
            </p>
        </div>
    </div>

    <script>
        // å†…ç½®æ•°æ®åº“
        const database = {
            'æ‰¾ä¸€ä¸ª 3.3v ldo': [
                { part: 'LD1117V33', mfr: 'STMicroelectronics', desc: 'LDO Voltage Regulator 3.3V 1A', price: 0.15, stock: 365000, score: 100, voltage: '3.3V', current: '1A', package: 'SOT-223' },
                { part: 'AMS1117-3.3', mfr: 'Advanced Monolithic', desc: 'LDOç¨³å‹å™¨ 3.3V 1A SOT-223', price: 0.08, stock: 750000, score: 100, voltage: '3.3V', current: '1A', package: 'SOT-223' },
                { part: 'ME6211C33', mfr: 'Midsummer', desc: 'LDO 3.3V 500mA SOT-23-5', price: 0.04, stock: 1500000, score: 90, voltage: '3.3V', current: '500mA', package: 'SOT-23-5' },
                { part: 'SPX5205', mfr: 'Maxlinear', desc: 'LDO 3.3V 500mA ä½å‹å·®', price: 0.12, stock: 180000, score: 85, voltage: '3.3V', current: '500mA', package: 'SOT-23-5' }
            ],
            'stm32 å•ç‰‡æœº': [
                { part: 'STM32F103C8T6', mfr: 'STMicroelectronics', desc: 'ARM Cortex-M3 64KB Flash 20KB RAM', price: 0.95, stock: 15000, score: 85, voltage: '3.3V', package: 'LQFP-48' },
                { part: 'GD32F103C8T6', mfr: 'å…†æ˜“åˆ›æ–°', desc: 'å›½äº§æ›¿ä»£ 100%å…¼å®¹', price: 0.85, stock: 30000, score: 90, voltage: '3.3V', package: 'LQFP-48', alt: 'âœ… GD32å›½äº§æ›¿ä»£ï¼Œä¾¿å®œ10%' },
                { part: 'STM32G431CBU6', mfr: 'STMicroelectronics', desc: 'Cortex-M4 128KB Flash æ›´å¼ºæ€§èƒ½', price: 1.85, stock: 8500, score: 80, voltage: '3.3V', package: 'UFQFPN-32' }
            ],
            'esp32 wifi æ¨¡å—': [
                { part: 'ESP32-WROOM-32', mfr: 'ä¹é‘«', desc: 'WiFi+BT Module 4MB Flash', price: 1.85, stock: 290000, score: 95, voltage: '3.3V', package: 'Module' },
                { part: 'ESP32-C3FH4', mfr: 'ä¹é‘«', desc: 'RISC-Vå†…æ ¸ æ›´çœç”µ', price: 0.95, stock: 85000, score: 85, voltage: '3.3V', package: 'QFN-32' },
                { part: 'ESP32-S3-WROOM', mfr: 'ä¹é‘«', desc: 'åŒæ ¸ AIåŠ é€Ÿ', price: 2.45, stock: 45000, score: 75, voltage: '3.3V', package: 'Module' }
            ],
            'usb è½¬ä¸²å£': [
                { part: 'CH340G', mfr: 'æ²æ’', desc: 'USB to UART Converter', price: 0.18, stock: 52000, score: 95, voltage: '5V/3.3V', package: 'SOP-16' },
                { part: 'CP2102N', mfr: 'Silicon Labs', desc: 'USB to UART Bridge', price: 1.45, stock: 12000, score: 80, voltage: '3.3V', package: 'QFN-24' },
                { part: 'FT232R', mfr: 'FTDI', desc: 'USB UART IC', price: 3.20, stock: 8000, score: 70, voltage: '3.3V', package: 'SSOP-28' }
            ],
            'åŒè¿æ”¾': [
                { part: 'LM358', mfr: 'TI', desc: 'Dual Op-Amp Low Power', price: 0.06, stock: 200000, score: 95, voltage: '3-32V', package: 'SOP-8' },
                { part: 'TL072', mfr: 'TI', desc: 'Dual Low-Noise JFET Op-Amp', price: 0.08, stock: 80000, score: 90, voltage: 'Â±6~18V', package: 'SOP-8' },
                { part: 'NE5532', mfr: 'TI', desc: 'Low Noise Dual Op-Amp', price: 0.25, stock: 30000, score: 85, voltage: 'Â±5~22V', package: 'SOP-8' },
                { part: 'MCP6002', mfr: 'Microchip', desc: '1MHz Low Power Dual Op-Amp', price: 0.22, stock: 42000, score: 80, voltage: '1.8-6V', package: 'SOP-8' }
            ],
            'stm32 å›½äº§æ›¿ä»£': [
                { part: 'GD32F103C8T6', mfr: 'å…†æ˜“åˆ›æ–°', desc: 'å›½äº§æ›¿ä»£ 100%å…¼å®¹', price: 0.85, stock: 30000, score: 95, voltage: '3.3V', package: 'LQFP-48', alt: 'âœ… ä»·æ ¼ä¾¿å®œ10%ï¼Œæ€§èƒ½æ›´å¼º' },
                { part: 'HK32F103C8T6', mfr: 'èˆªé¡ºå¾®', desc: 'å›½äº§æ›¿ä»£ 95%å…¼å®¹', price: 0.80, stock: 18000, score: 85, voltage: '3.3V', package: 'LQFP-48', alt: 'âš ï¸ ADCç²¾åº¦ç•¥æœ‰å·®å¼‚' },
                { part: 'APM32F103', mfr: 'ææµ·', desc: 'å›½äº§æ›¿ä»£ 100%å…¼å®¹', price: 0.88, stock: 22000, score: 88, voltage: '3.3V', package: 'LQFP-48' }
            ],
            '5v ldo': [
                { part: 'LM7805', mfr: 'TI', desc: 'LDO 5V 1.5A', price: 0.12, stock: 150000, score: 95, voltage: '5V', current: '1.5A', package: 'TO-220' },
                { part: 'AMS1117-5.0', mfr: 'Advanced Monolithic', desc: 'LDO 5V 1A', price: 0.07, stock: 680000, score: 90, voltage: '5V', current: '1A', package: 'SOT-223' },
                { part: 'LD1117V50', mfr: 'STMicroelectronics', desc: 'LDO 5V 1A', price: 0.18, stock: 120000, score: 85, voltage: '5V', current: '1A', package: 'SOT-223' }
            ],
            'ç”µæºèŠ¯ç‰‡': [
                { part: 'LM2596S-5.0', mfr: 'TI', desc: 'é™å‹ç”µæºæ¨¡å— 5V 3A', price: 0.45, stock: 95000, score: 95, voltage: '5V', current: '3A', package: 'TO-263' },
                { part: 'MP2359', mfr: 'MPS', desc: 'é™å‹IC 1.2A', price: 0.35, stock: 48000, score: 85, voltage: 'å¯è°ƒ', current: '1.2A', package: 'SOT-23-6' },
                { part: 'TPS63020', mfr: 'TI', desc: 'å‡é™å‹ 96%æ•ˆç‡', price: 1.20, stock: 18000, score: 75, voltage: '1.8-5.5V', current: '3A', package: 'QFN-20' }
            ],
            'å­˜å‚¨å™¨': [
                { part: 'W25Q128', mfr: 'Winbond', desc: 'SPI Flash 128Mbit', price: 0.85, stock: 65000, score: 95, voltage: '3.3V', package: 'SOIC-8' },
                { part: 'AT24C256', mfr: 'Microchip', desc: 'I2C EEPROM 256Kb', price: 0.22, stock: 120000, score: 90, voltage: '1.8-5.5V', package: 'SOP-8' },
                { part: 'FM24C256', mfr: 'å¤æ—¦å¾®', desc: 'å›½äº§EEPROM 256Kb', price: 0.18, stock: 85000, score: 85, voltage: '3.3V', package: 'SOP-8' }
            ],
            'ä¼ æ„Ÿå™¨': [
                { part: 'BME280', mfr: 'Bosch', desc: 'æ¸©æ¹¿åº¦æ°”å‹ä¼ æ„Ÿå™¨', price: 1.85, stock: 35000, score: 90, voltage: '1.8-3.6V', package: 'LGA-8' },
                { part: 'DHT11', mfr: 'Aosong', desc: 'æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ æ¨¡å—', price: 0.45, stock: 180000, score: 85, voltage: '3.3-5V', package: 'Module' },
                { part: 'MPU6050', mfr: 'TDK Invensense', desc: '6è½´åŠ é€Ÿåº¦è®¡é™€èºä»ª', price: 0.95, stock: 48000, score: 88, voltage: '3.3V', package: 'QFN-16' },
                { part: 'SGP30', mfr: 'Sensirion', desc: 'VOCä¼ æ„Ÿå™¨', price: 2.45, stock: 12000, score: 80, voltage: '3.3V', package: 'LGA-16' }
            ]
        };

        // ç¤ºä¾‹ BOM
        const exampleBOM = [
            { ref: 'U1', part: 'STM32F103C8T6', qty: 1, price: 0.95, status: 'NRND', risk: 'medium', cad: 'âœ…' },
            { ref: 'U2', part: 'CH340C', qty: 1, price: 0.18, status: 'Active', risk: 'low', cad: 'âœ…' },
            { ref: 'U3', part: 'AMS1117-3.3', qty: 1, price: 0.08, status: 'Active', risk: 'low', cad: 'âœ…' },
            { ref: 'U4', part: 'ESP32-WROOM-32', qty: 1, price: 1.85, status: 'Active', risk: 'low', cad: 'âœ…' },
            { ref: 'U5', part: 'LM358', qty: 1, price: 0.06, status: 'Active', risk: 'low', cad: 'âœ…' },
            { ref: 'C1', part: '10uF/10V', qty: 5, price: 0.01, status: 'Active', risk: 'low', cad: 'âœ…' },
            { ref: 'R1', part: '10K 0805', qty: 10, price: 0.005, status: 'Active', risk: 'low', cad: 'âœ…' }
        ];

        // æ”¶è—åˆ—è¡¨å’Œæœç´¢å†å²
        let favorites = JSON.parse(localStorage.getItem('openpart_favorites') || '[]');
        let searchHistory = JSON.parse(localStorage.getItem('openpart_history') || '[]');

        function saveFavorites() {
            localStorage.setItem('openpart_favorites', JSON.stringify(favorites));
            renderFavorites();
        }

        function saveHistory() {
            localStorage.setItem('openpart_history', JSON.stringify(searchHistory));
        }

        function toggleFavorite(part, mfr, desc, price, voltage, package) {
            const idx = favorites.findIndex(f => f.part === part);
            if (idx >= 0) {
                favorites.splice(idx, 1);
            } else {
                favorites.push({ part, mfr, desc, price, voltage, package, time: Date.now() });
            }
            saveFavorites();
            
            // æ›´æ–°æ‰€æœ‰ç»“æœå¡ç‰‡çš„æ”¶è—æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.fav-btn').forEach(btn => {
                const btnPart = btn.dataset.part;
                btn.textContent = favorites.some(f => f.part === btnPart) ? 'â¤ï¸' : 'ğŸ¤';
            });
        }

        function renderFavorites() {
            const container = document.getElementById('favorites-list');
            if (favorites.length === 0) {
                container.innerHTML = `
                    <div style="text-align:center;padding:40px;color:#8892b0;">
                        <p style="font-size:48px;margin-bottom:15px;">ğŸ’”</p>
                        <p>æš‚æ— æ”¶è—</p>
                        <p style="font-size:13px;margin-top:10px;">ç‚¹å‡»ç»“æœå¡ç‰‡ä¸Šçš„ â¤ï¸ æ·»åŠ æ”¶è—</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            favorites.forEach((r, i) => {
                html += `
                    <div class="result">
                        <h3>ğŸ“¦ ${r.part}</h3>
                        <p>${r.mfr} | ${r.desc}</p>
                        <div class="tags">
                            <span class="tag price">ğŸ’° Â¥${r.price.toFixed(2)}</span>
                            <span class="tag">âš¡ ${r.voltage}</span>
                            <span class="tag">ğŸ”Œ ${r.package}</span>
                            <span class="tag warning" onclick="toggleFavorite('${r.part}','${r.mfr}','${r.desc}',${r.price},'${r.voltage}','${r.package}')" style="cursor:pointer;">ğŸ’” ç§»é™¤</span>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function clearFavorites() {
            if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰æ”¶è—ï¼Ÿ')) {
                favorites = [];
                saveFavorites();
            }
        }

        function addToHistory(query) {
            const idx = searchHistory.indexOf(query);
            if (idx >= 0) searchHistory.splice(idx, 1);
            searchHistory.unshift(query);
            if (searchHistory.length > 10) searchHistory.pop();
            saveHistory();
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history-list');
            if (searchHistory.length === 0) {
                container.innerHTML = '<p style="color:#8892b0;font-size:13px;padding:10px;">æš‚æ— æœç´¢å†å²</p>';
                return;
            }
            
            container.innerHTML = searchHistory.map((q, i) => 
                `<button class="example-btn" onclick="setQuery('${q}')">${i+1}. ${q}</button>`
            ).join('');
        }

        function setQuery(text) {
            document.getElementById('searchInput').value = text;
            search();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            ['select', 'bom', 'eol', 'cad', 'favorites'].forEach(p => {
                document.getElementById('panel-' + p).style.display = p === tab ? 'block' : 'none';
            });
        }

        function search() {
            const query = document.getElementById('searchInput').value.trim().toLowerCase();
            if (!query) return alert('è¯·è¾“å…¥æœç´¢å†…å®¹');
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(query);
            
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            loading.classList.add('show');
            results.innerHTML = '';
            
            // æ¨¡æ‹Ÿæœç´¢å»¶è¿Ÿ
            setTimeout(() => {
                let matched = null;
                let matchType = '';
                
                // å…³é”®è¯åŒ¹é… - å¢å¼ºç‰ˆ
                for (const key in database) {
                    if (query === key || query.includes(key) || key.includes(query)) {
                        matched = database[key];
                        matchType = 'ç²¾ç¡®åŒ¹é…';
                        break;
                    }
                }
                
                // éƒ¨åˆ†åŒ¹é…
                if (!matched) {
                    for (const key in database) {
                        const keywords = key.split(/[\s,ï¼Œã€]+/);
                        for (const kw of keywords) {
                            if (kw.length > 2 && (query.includes(kw) || kw.includes(query))) {
                                matched = database[key];
                                matchType = 'å…³é”®è¯åŒ¹é…';
                                break;
                            }
                        }
                        if (matched) break;
                    }
                }
                
                // é»˜è®¤è¿”å›å¤šä¸ªç›¸å…³ç»“æœ
                if (!matched) {
                    // è¿”å›æ‰€æœ‰ç›¸å…³ç±»åˆ«
                    const related = [];
                    for (const [key, items] of Object.entries(database)) {
                        for (const item of items) {
                            const searchText = (item.part + item.mfr + item.desc).toLowerCase();
                            if (searchText.includes(query) || query.split(/[\s,ï¼Œ]+/).some(q => searchText.includes(q))) {
                                related.push(item);
                            }
                        }
                    }
                    
                    if (related.length > 0) {
                        matched = related.slice(0, 6); // æœ€å¤š6ä¸ª
                        matchType = 'æ™ºèƒ½æ¨è';
                    }
                }
                
                // å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œæç¤º
                if (!matched || matched.length === 0) {
                    results.innerHTML = `
                        <div class="warning-box">
                            <h4>ğŸ” æœªæ‰¾åˆ°åŒ¹é…ç»“æœ</h4>
                            <p>å°è¯•ä»¥ä¸‹æ–¹å¼ï¼š</p>
                            <ul>
                                <li>ç®€åŒ–æœç´¢è¯ï¼Œå¦‚ "stm32"ã€"ldo"ã€"è¿æ”¾"</li>
                                <li>ä½¿ç”¨é€šç”¨æè¿°ï¼Œå¦‚ "ç”µæºèŠ¯ç‰‡"ã€"ä¼ æ„Ÿå™¨"</li>
                                <li>æŸ¥çœ‹ä¸‹æ–¹çƒ­é—¨æœç´¢</li>
                            </ul>
                        </div>
                    `;
                    loading.classList.remove('show');
                    return;
                }
                
                let html = `<h3 style="margin:20px 0 10px;">ğŸ“¦ æ¨èç»“æœ - ${matchType} (${matched.length} ä¸ª)</h3>`;
                
                matched.forEach((r, i) => {
                    const statusClass = r.score >= 95 ? 'success' : r.score >= 80 ? 'warning' : '';
                    const isFav = favorites.some(f => f.part === r.part);
                    html += `
                        <div class="result" style="position:relative;">
                            <h3>${i+1}. ğŸ“¦ ${r.part}</h3>
                            <p>${r.mfr} | ${r.desc}</p>
                            <div class="tags">
                                <span class="tag price">ğŸ’° Â¥${r.price.toFixed(2)}</span>
                                <span class="tag">ğŸ“¦ ${r.stock.toLocaleString()}ä»¶</span>
                                <span class="tag ${statusClass}">ğŸ¯ åŒ¹é…åº¦ ${r.score}%</span>
                                <span class="tag">âš¡ ${r.voltage || 'N/A'}</span>
                                <span class="tag">ğŸ”Œ ${r.package}</span>
                                ${r.alt ? `<span class="tag warning">${r.alt}</span>` : ''}
                                <span class="fav-btn tag ${isFav ? 'warning' : ''}" 
                                      data-part="${r.part}"
                                      onclick="toggleFavorite('${r.part}','${r.mfr}','${r.desc}',${r.price},'${r.voltage || 'N/A'}','${r.package}')"
                                      style="cursor:pointer;">
                                    ${isFav ? 'â¤ï¸' : 'ğŸ¤'}
                                </span>
                            </div>
                        </div>
                    `;
                });
                
                // æ™ºèƒ½æ¨èæç¤º
                if (matched.length >= 3) {
                    html += `
                        <div class="warning-box" style="background: rgba(0,210,255,0.1);border-color:rgba(0,210,255,0.3);">
                            <h4>ğŸ’¡ é€‰å‹å»ºè®®</h4>
                            <ul>
                                <li>${matched[0].part} - æ€§ä»·æ¯”é¦–é€‰ï¼Œåº“å­˜å……è¶³</li>
                                ${matched[1] ? `<li>${matched[1].part} - ${matched[1].alt || 'å¤‡é€‰æ–¹æ¡ˆ'}</li>` : ''}
                                <li>ç‚¹å‡» â¤ï¸ æ”¶è—å™¨ä»¶ï¼Œæ–¹ä¾¿åç»­æŸ¥çœ‹</li>
                            </ul>
                        </div>
                    `;
                }
                
                results.innerHTML = html;
                loading.classList.remove('show');
                
                // åˆ‡æ¢åˆ°é€‰å‹é¢æ¿
                switchTab('select');
                document.querySelector('.tab').click();
            }, 600);
        }

        function loadBOM() {
            const tbody = document.getElementById('bom-body');
            let total = 0, riskCount = 0, save = 0;
            
            tbody.innerHTML = exampleBOM.map(item => {
                total += item.price * item.qty;
                if (item.risk === 'medium') riskCount++;
                save += item.price * item.qty * 0.3;
                
                const riskClass = item.risk === 'medium' ? 'warning' : 'success';
                const statusIcon = item.status === 'NRND' ? 'âš ï¸ NRND' : item.status === 'LastTimeBuy' ? 'ğŸ”´ LastTimeBuy' : 'âœ… Active';
                
                return `<tr>
                    <td>${item.ref}</td>
                    <td>${item.part}</td>
                    <td>${item.qty}</td>
                    <td>Â¥${item.price.toFixed(2)}</td>
                    <td><span class="tag ${riskClass}">${statusIcon}</span></td>
                    <td><span class="tag ${riskClass}">${item.risk.toUpperCase()}</span></td>
                </tr>`;
            }).join('');
            
            document.getElementById('bom-count').textContent = exampleBOM.length;
            document.getElementById('bom-price').textContent = 'Â¥' + total.toFixed(2);
            document.getElementById('bom-risk').textContent = riskCount;
            document.getElementById('bom-save').textContent = 'Â¥' + save.toFixed(2);
        }

        // å›è½¦æœç´¢
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') search();
        });

        // åˆå§‹åŠ è½½
        setTimeout(() => {
            loadBOM();
            renderFavorites();
            renderHistory();
        }, 500);
    </script>
</body>
</html>
